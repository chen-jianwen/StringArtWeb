# StringArtWeb 后端接口与数据库设计文档

## 一、数据库表结构（MySQL）

### 1. 用户表（user）
| 字段名      | 类型           | 约束         | 说明         |
| ----------- | -------------- | ------------ | ------------ |
| id          | INT            | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| phone       | VARCHAR(20)    | UNIQUE       | 手机号       |
| username    | VARCHAR(32)    | UNIQUE, 可选 | 用户名       |
| password    | VARCHAR(128)   | NOT NULL     | 密码（哈希） |
| create_time | DATETIME       | DEFAULT CURRENT_TIMESTAMP | 注册时间 |

### 2. 订单表（order）
| 字段名      | 类型           | 约束         | 说明         |
| ----------- | -------------- | ------------ | ------------ |
| id          | INT            | PRIMARY KEY, AUTO_INCREMENT | 订单ID |
| order_no    | VARCHAR(32)    | UNIQUE       | 订单号       |
| user_id     | INT            | FOREIGN KEY(user.id) | 关联用户（后台所有订单操作自动同步用户信息） |
| price       | DECIMAL(10,2)  |              | 价格         |
| config_file | TEXT           |              | 弦艺配置文件（JSON） |
| create_time | DATETIME       | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

### 3. 中断步骤表（interrupt_step）
| 字段名        | 类型         | 约束         | 说明         |
| ------------- | ------------ | ------------ | ------------ |
| id            | INT          | PRIMARY KEY, AUTO_INCREMENT | 步骤ID |
| order_id      | INT          | FOREIGN KEY(order.id) | 关联订单 |
| step_info     | TEXT         |              | 步骤信息（JSON） |
| interrupt_time| DATETIME     | DEFAULT CURRENT_TIMESTAMP | 中断时间 |

### 4. 画廊表（gallery）
| 字段名      | 类型           | 约束         | 说明         |
| ----------- | -------------- | ------------ | ------------ |
| id          | INT            | PRIMARY KEY, AUTO_INCREMENT | 作品ID |
| title       | VARCHAR(64)    |              | 作品标题     |
| preview_img | VARCHAR(128)   |              | 预览图片路径 |
| config_file | TEXT           |              | 配置文件（JSON） |

---

## 二、主要后端 API 路径设计（Flask 示例）

### 1. 登录与注册
- POST /api/login
  - 参数：phone/order_no/username + password 或 游客
  - 返回：用户信息、token
- POST /api/register
  - 参数：phone, username, password
  - 返回：注册结果

### 2. 订单与配置文件
- GET /api/orders?user_id=xxx
  - 返回：该用户所有订单列表
- GET /api/order/<order_no>
  - 返回：订单详情及配置文件
- POST /api/order
  - 参数：user_id, config_file, price
  - 返回：新订单信息

### 3. 中断步骤
- POST /api/interrupt
  - 参数：order_no, step_info
  - 返回：保存结果
- GET /api/interrupt/<order_no>
  - 返回：最近中断步骤

### 4. 弦艺可视化与指导
- GET /api/stringart/steps?order_no=xxx
  - 返回：绕线步骤数据
- GET /api/gallery
  - 返回：画廊作品列表
- GET /api/gallery/<id>
  - 返回：作品详情

### 5. 后台维护
- GET /api/admin/orders
  - 返回：所有订单（含关联用户信息）
- GET /api/admin/gallery
  - 返回：所有画廊作品

---

## 三、接口返回值格式
统一 JSON：
```
{
  "code": 0,
  "msg": "success",
  "data": {...}
}
```

---

## 四、目录结构建议
```
backend/
    app.py                # Flask 主入口
    models.py             # 数据库模型
    routes/
        auth.py           # 登录相关接口
        stringart.py      # 弦艺相关接口
        gallery.py        # 画廊接口
        admin.py          # 后台接口
    utils.py              # 工具函数
    config.py             # 配置文件
    requirements.txt      # 依赖包列表
```

---

## 五、说明
- 用户表与订单表为一对多关系（user.id <-> order.user_id），后台所有订单操作自动同步用户信息。
- 订单与中断步骤为一对多关系（order.id <-> interrupt_step.order_id）
- 画廊表用于游客和主界面展示预设作品
- 所有接口建议加鉴权（如 token 校验）

如需建表 SQL 或 Flask 路由代码示例，可随时补充。